# ERA5 Example Output

A short guide to generating output ERA5 data from the [Copernicus Data Store](https://cds.climate.copernicus.eu/cdsapp#!/dataset/reanalysis-era5-single-levels?tab=overview).

For a full list of supported ERA5 outputs, see (LINK):

## Setup

Let's assume we've created an ERA5 cutout along the following lines:

```
cutout = geodata.Cutout(name="era5-europe-example",
                       module="era5",
                       weather_data_config="era5_monthly",
                       xs=slice(30, 41.56244222),
                        ys=slice(33.56459975, 35),
                       years=slice(2011, 2011),
                       months=slice(1,1))
cutout.prepare();
```

We can now use this cutout to generate datasets.

## Creating a Solar photovoltaic (pv) generation time-series

To create a pv generation time-series, we can use the following code with our ERA5 cutout:


```
ds = geodata.convert.pv(cutout, panel="KANENA", orientation = "latitude_optimal")
```

Some information about the parameters:
* `panel` - string - Specify a solar panel type on which to base the calculation.  **geodata** contains an internal solar panel dictionary with keys defining several solar panel characteristics used for the time-series calculation.  For a complete list of included panel types, see [the list of panel types here.](LINK HERE)
* `orientation` - str, dict or callback - Panel orientation can be chosen from either `latitude_optimal`, a constant orientation such as `{'slope': 0.0,'azimuth': 0.0}`,  or a callback function with the same signature as the callbacks generated by the `geodata.pv.orientation.make_*` functions.
* (optional) clearsky_model - string or None - 	Either the `simple` or the `enhanced` Reindl clearsky model. The default choice of None will choose dependending on data availability, since the `enhanced` model also incorporates ambient air temperature and relative humidity.


The convert function returns an xarray dataset, which is an in-memory representation of a NetCDF file:

```
<xarray.DataArray 'AC power' (y: 5, time: 744, x: 47)>
array([[[0., 0., 0., ..., 0., 0., 0.],
        [0., 0., 0., ..., 0., 0., 0.],
        [0., 0., 0., ..., 0., 0., 0.],

Coordinates:
    lon      (x) float32 30.0 30.25 30.5 30.75 31.0 ... 40.75 41.0 41.25 41.5
    lat      (y) float32 34.815 34.565 34.315 34.065 33.815
  * x        (x) float32 30.0 30.25 30.5 30.75 31.0 ... 40.75 41.0 41.25 41.5
  * y        (y) float32 34.815 34.565 34.315 34.065 33.815
  * time     (time) datetime64[ns] 2011-01-01 ... 2011-01-31T23:00:00
```

To convert this array to a more conventional dataframe, we can run:

```
df = ds.to_dataframe(name='pv')
```

which converts the xarray dataset into a pandas dataframe.  Let's examine the output:

[image link]


The result is a dataset with an observation for each time period (in this ERA5 case, hourly) and geographic point with the calculated pv generation for each observation.

Finally, we can run something like:

```
df.to_csv('era5_pv_data.csv')
```

to output the data to csv for use in other applications.
